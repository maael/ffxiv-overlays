{"version":3,"file":"static/webpack/static/development/pages/t/sparky.js.a5e13bd769d2791cd629.hot-update.js","sources":["webpack:///./pages/t/sparky.tsx"],"sourcesContent":["import React from 'react';\nimport {Sparklines, SparklinesLine} from 'react-sparklines';\nimport DragCorner from '../../components/DragCorner';\nimport simulator from '../../util/simulator';\nimport jobColours from '../../util/colours'\nimport {jobRoleMap} from '../../util/roles';\nimport {CombatantOptions, EncounterOptions, RoleColoursLight} from '../../util/types';\n\ntype EncOverType = Map<string, number[]>;\n\ninterface State {\n  Combatant?: Record<string, Partial<Record<CombatantOptions, string>>>;\n  Encounter?: Partial<Record<EncounterOptions, string>>;\n  isActive?: 'true' | 'false';\n  encOverTime: EncOverType;\n}\n\nexport default class Sparky extends React.Component<State> {\n  state: State = {\n    encOverTime: new Map()\n  };\n  simulator?: NodeJS.Timeout;\n  componentDidMount () {\n    if (typeof window === 'undefined') return;\n    document.addEventListener('onOverlayDataUpdate', this.onOverlayDataUpdate);\n    window.addEventListener('message', (e) => {\n      if (e.data.type === 'onOverlayDataUpdate') {\n        this.onOverlayDataUpdate(e.data);\n      }\n    });\n    if (window.location.search.includes('simulator')) {\n      this.simulator = simulator(1000);\n    }\n  }\n  componentWillUpdate(_newProps, newState) {\n    if (this.state.isActive === 'false' && newState === 'true') {\n      this.setState({encOverTime: new Map()})\n    }\n  }\n  componentWillUnmount () {\n    if (simulator) clearInterval(this.simulator);\n  }\n  onOverlayDataUpdate = (data: any) => {\n    const Combatant: Record<string, Partial<Record<CombatantOptions, string>>> = data.detail.Combatant;\n    const {encOverTime} = this.state;\n    Object.entries(Combatant).forEach(([k, v]) => {\n      encOverTime.set(k, [...(encOverTime.get(k) || []).splice(-25), Number(v.encdps)].filter((i) => !isNaN(i)))\n    });\n    this.setState({...data.detail, encOverTime});\n  }\n  renderCombatant = ([k, v]) => {\n    const upperJob = (v.Job || '').toUpperCase();\n    const jobColour = jobColours(upperJob);\n    const role = jobRoleMap[v.Job];\n    console.info('>', role, v.Job)\n    return (\n      <div className={`${v.role}-sparks`} style={{float: 'left', padding: '0 15px', textAlign: 'center', width: 200, color: '#FFFFFF', fontWeight: 'bold', textShadow: `0 0 5px ${jobColour}`}} key={v.name}>\n        <Sparklines data={this.state.encOverTime.get(k)} height={50}>\n          <SparklinesLine style={{fillOpacity: 0.5}} color={jobColour} />\n        </Sparklines>\n        <div style={{fontSize: '0.8em'}}>{v.name} ({upperJob})</div>\n        <div>{v.encdps}</div>\n      </div>\n    )\n  }\n  render () {\n    const {Combatant} = this.state;\n    const filters = ['YOU 0', 'YOU']\n    const Combatants = Combatant\n      ? Object.entries(Combatant)\n          .filter(([k, v]) => filters.indexOf(k) > -1)\n          .sort(([_k1, v1], [_k2, v2]) => Number(v2.encdps) - Number(v1.encdps))\n          .map(this.renderCombatant)\n      : null;\n    return (\n      <>\n        <style global jsx>{`\n          body {\n            font-family: sans-serif;\n          }\n          svg polyline:first-of-type {\n            fill-opacity: 0.5;\n          }\n          .HEALER-sparkes svg polyline:first-of-type {\n            fill: ${RoleColoursLight.HEALER};\n          }\n          .TANK-sparkes svg polyline:first-of-type {\n            fill: ${RoleColoursLight.TANK};\n          }\n          .DPS-sparkes svg polyline:first-of-type {\n            fill: ${RoleColoursLight.DPS};\n          }\n        `}</style>\n        <DragCorner />\n        {Combatants}\n      </>\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;;;;;;;;;;;;;;;;;;AACA;AACA;AADA;AACA;;;AAuBA;AACA;AADA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;;;;;;AA3CA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;;;AACA;AACA;AACA;;;AAwBA;AAAA;AAEA;AACA;AAEA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAkBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;AAhFA;AACA;;;;;A","sourceRoot":""}