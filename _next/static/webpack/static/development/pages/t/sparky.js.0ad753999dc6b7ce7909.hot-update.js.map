{"version":3,"file":"static/webpack/static/development/pages/t/sparky.js.0ad753999dc6b7ce7909.hot-update.js","sources":["webpack:///./pages/t/sparky.tsx"],"sourcesContent":["import React from 'react';\nimport {Sparklines, SparklinesLine} from 'react-sparklines';\nimport ActBase, {State as ActBaseState} from '../../components/ActBase';\nimport Settings from '../../components/Settings';\nimport SettingsPanel from '../../components/SettingsPanel';\nimport jobColours from '../../util/colours'\nimport {jobRoleMap} from '../../util/roles';\nimport {RoleColoursLight} from '../../util/types';\n\ninterface State {\n  encOverTime: Map<string, number[]>;\n  height: number;\n  width: number;\n}\n\nexport default class Sparky extends React.Component<State> {\n  state: State = {\n    encOverTime: new Map(),\n    height: 0,\n    width: 0,\n  };\n  componentDidMount () {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', this.onResize);\n    }\n  }\n  componentWillUnmount () {\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('resize', this.onResize);\n    }\n  }\n  onResize = ({target}) => {\n    this.setState({height: target.height, width: target.width});\n  }\n  onBecomeActive() {\n    this.setState({encOverTime: new Map()});\n  }\n  onOverlayDataUpdate = ({Combatant}: ActBaseState) => {\n    if (!Combatant) return;\n    const {encOverTime} = this.state;\n    Object.entries(Combatant).forEach(([k, v]) => {\n      encOverTime.set(k, [...(encOverTime.get(k) || []).splice(-25), Number(v.encdps)].filter((i) => !isNaN(i)))\n    });\n    this.setState({encOverTime});\n  }\n  renderCombatant = ([k, v]) => {\n    const upperJob = (v.Job || '').toUpperCase();\n    const jobColour = jobColours(upperJob);\n    const role = jobRoleMap[upperJob];\n    return (\n      <div className={`${role}-sparks`} style={{float: 'left', padding: '0 15px', textAlign: 'center', width: 200, color: '#FFFFFF', fontWeight: 'bold', textShadow: `0 0 5px ${jobColour}`}} key={v.name}>\n        <Sparklines data={this.state.encOverTime.get(k)} height={50}>\n          <SparklinesLine style={{fillOpacity: 0.5}} color={jobColour} />\n        </Sparklines>\n        <div style={{fontSize: '0.8em'}}>{v.name} ({upperJob})</div>\n        <div>{v.encdps}</div>\n      </div>\n    )\n  }\n  render () {\n    return (\n      <ActBase onOverlayDataUpdate={this.onOverlayDataUpdate} onBecomeActive={this.onBecomeActive}>\n        {({Combatant}) => {\n          const filters = ['YOU 0', 'YOU']\n          const Combatants = Combatant\n            ? Object.entries(Combatant)\n                .filter(([k, v]) => filters.indexOf(k) > -1)\n                .map(this.renderCombatant)\n            : null;\n          return (\n            <SparkySettings>\n              <style global jsx>{`\n                body {\n                  font-family: sans-serif;\n                }\n                svg polyline:first-of-type {\n                  fill-opacity: 0.5 !important;\n                }\n                svg circle {\n                  fill: none !important;\n                }\n                .HEALER-sparks svg polyline:first-of-type {\n                  fill: ${RoleColoursLight.HEALER} !important;\n                }\n                .TANK-sparks svg polyline:first-of-type {\n                  fill: ${RoleColoursLight.TANK} !important;\n                }\n                .DPS-sparks svg polyline:first-of-type {\n                  fill: ${RoleColoursLight.DPS} !important;\n                }\n              `}</style>\n              {Combatants}\n              <>\n                {this.state.height} {this.state.width}\n              </>\n            </SparkySettings>\n          );\n        }}\n      </ActBase>\n    );\n  }\n}\n\nclass SparkySettings extends React.Component {\n  state = {\n    playerFilters: []\n  };\n  render () {\n    return (\n      <Settings<{playerFilters: string[]}> themeKey='sparky'>\n        <SettingsPanel>\n          {[...this.state.playerFilters, ''].map((f, i) => (\n            <div key={`${i}`}>\n              <span>Player Filter:</span>\n              <input\n                type='text'\n                onChange={({target}) => {\n                  const ar = [].concat(this.state.playerFilters);\n                  if (target.value.length === 0) {\n                    ar.splice(i, 1);\n                  } else {\n                    ar[i] = target.value;\n                  }\n                  this.setState({playerFilters: ar})\n                }}\n              />\n            </div>\n          ))}\n              </SettingsPanel>\n        {this.props.children}\n      </Settings>\n    );\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AAHA;AACA;AAcA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AAAA;AACA;AADA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;;;;;;AAtCA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;;;AAIA;AACA;AAAA;AAAA;AACA;;;AAuBA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AADA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2BA;AAGA;;;;AArFA;AACA;AADA;AACA;AAuFA;;;;;;;;;;;;;;;;;;AACA;AACA;AADA;AACA;;;;;;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAqBA;;;;AA7BA;;;;A","sourceRoot":""}